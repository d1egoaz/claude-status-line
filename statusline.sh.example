#!/usr/bin/env bash
input=$(cat)

model=$(echo "$input" | jq -r '.model.display_name // .model.id // "?"')
cost=$(echo "$input" | jq -r '(.cost.total_cost_usd // 0) | round')
dir=$(echo "$input" | jq -r '.cwd // "" | split("/") | last // "?"')
max=$(echo "$input" | jq -r '.context_window.context_window_size // 200000')
pct=$(echo "$input" | jq -r '.context_window.used_percentage // 0')

used_k=$(echo "$input" | jq -r --argjson max "$max" --argjson pct "$pct" '$max * $pct / 100 / 1000 | floor')
max_k=$(echo "$input" | jq -r --argjson max "$max" '$max / 1000 | floor')
pct_r=$(echo "$input" | jq -r --argjson pct "$pct" '$pct | round')

echo "[$model] \$${cost} - ðŸ“‚[${dir}] - ${used_k}k/${max_k}k (${pct_r}%)"
